{{ define "main" }}
<!-- Header Section - Title with Content Width -->
<header class="mb-6 text-center w-full py-4">
  <!-- Title container: same width as content -->
  <div class="max-w-4xl mx-auto px-4">
    <h1 class="text-7xl md:text-8xl lg:text-9xl xl:text-[12rem] 2xl:text-[14rem] font-bold text-gray-900 dark:text-white mb-4 leading-tight">
      {{ .Title }}
    </h1>
  </div>
</header>

<div class="w-full px-4 py-4">
<article class="max-w-4xl mx-auto">
  <!-- Content Header Section -->
  <div class="mb-8 text-center">
    
    
    <!-- Authors -->
    {{ if .Params.authors }}
    <div class="mb-6">
      <div class="text-lg md:text-xl lg:text-2xl text-gray-700 dark:text-gray-300 leading-relaxed max-w-5xl mx-auto px-2">
        {{ $authorLinks := slice }}
        {{ range .Params.authors }}
          {{ $authorName := . }}
          {{ if eq . "admin" }}
            {{ $authorName = "Pengfei Shen" }}
            {{ $authorPage := site.GetPage "/authors/admin" }}
            {{ if and $authorPage $authorPage.Params.external_link }}
              {{ $authorLinks = $authorLinks | append (printf "<a href=\"%s\" target=\"_blank\" rel=\"noopener\" class=\"text-primary-600 dark:text-primary-400 hover:underline\">%s</a>" $authorPage.Params.external_link $authorName) }}
            {{ else }}
              {{ $authorLinks = $authorLinks | append $authorName }}
            {{ end }}
          {{ else if (strings.Contains . "admin") }}
            {{ $authorName = . | replaceRE "admin" "Pengfei Shen" | replaceRE "\\^([0-9]+)\\^" "<sup>$1</sup>" | safeHTML }}
            {{ $authorPage := site.GetPage "/authors/admin" }}
            {{ if and $authorPage $authorPage.Params.external_link }}
              {{ $authorLinks = $authorLinks | append (printf "<a href=\"%s\" target=\"_blank\" rel=\"noopener\" class=\"text-primary-600 dark:text-primary-400 hover:underline\">%s</a>" $authorPage.Params.external_link $authorName) }}
            {{ else }}
              {{ $authorLinks = $authorLinks | append $authorName }}
            {{ end }}
          {{ else }}
            {{ $authorName = . | replaceRE "\\^([0-9]+)\\^" "<sup>$1</sup>" | safeHTML }}
            {{ $cleanAuthorForPage := . | replaceRE "\\^[0-9]+\\^" "" | replaceRE "\\*$" "" | replaceRE "â€ " "" | lower | replaceRE " " "-" }}
            {{ $authorPage := site.GetPage (printf "/authors/%s" $cleanAuthorForPage) }}
            {{ if and $authorPage $authorPage.Params.external_link }}
              {{ $authorLinks = $authorLinks | append (printf "<a href=\"%s\" target=\"_blank\" rel=\"noopener\" class=\"text-primary-600 dark:text-primary-400 hover:underline\">%s</a>" $authorPage.Params.external_link $authorName) }}
            {{ else }}
              {{ $authorLinks = $authorLinks | append $authorName }}
            {{ end }}
          {{ end }}
        {{ end }}
        <p class="mb-2">{{ delimit $authorLinks ", " | safeHTML }}</p>
        
        <!-- Author affiliations and notes -->
        {{ if .Params.author_affiliations }}
        <div class="text-sm text-gray-600 dark:text-gray-400 mt-2">
          {{ range .Params.author_affiliations }}
          <p class="mb-1">{{ . | markdownify }}</p>
          {{ end }}
        </div>
        {{ end }}
        
        {{ if .Params.author_notes }}
        <div class="text-sm text-gray-600 dark:text-gray-400 mt-2">
          {{ .Params.author_notes | markdownify }}
        </div>
        {{ end }}
      </div>
    </div>
    {{ end }}
    
    <!-- Publication Info -->
    {{ if .Params.publication }}
    <div class="mb-4">
      <p class="text-xl md:text-2xl font-semibold text-primary-700 dark:text-primary-300">
        {{ .Params.publication | markdownify }}
      </p>
    </div>
    {{ end }}
    
    <!-- Date -->
    <p class="text-lg text-gray-600 dark:text-gray-400 mb-8">
      {{ .Date | time.Format (site.Params.locale.date_format | default ":date_long") }}
    </p>
    
    <!-- Action Buttons -->
    {{ if or .Params.url_pdf .Params.external_link .Params.url_code .Params.url_video }}
    <div class="flex flex-wrap justify-center gap-3 mb-8">
      {{ if .Params.url_pdf }}
      <a href="{{ .Params.url_pdf }}" target="_blank" rel="noopener" 
         class="inline-flex items-center px-6 py-3 rounded-full text-base font-semibold bg-gray-800 dark:bg-gray-200 text-white dark:text-gray-800 hover:bg-gray-900 dark:hover:bg-gray-100 transition-all duration-200 shadow-lg hover:shadow-xl">
        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"></path>
        </svg>
        Paper
      </a>
      {{ end }}
      
      {{ if .Params.external_link }}
      <a href="{{ .Params.external_link }}" target="_blank" rel="noopener"
         class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium bg-green-600 text-white hover:bg-green-700 transition-colors">
        ðŸ”— External Link
      </a>
      {{ end }}
      
      {{ if .Params.url_code }}
      <a href="{{ .Params.url_code }}" target="_blank" rel="noopener"
         class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 text-white hover:bg-gray-900 transition-colors">
        ðŸ’» Code
      </a>
      {{ end }}
      
      {{ if .Params.url_video }}
      <a href="{{ .Params.url_video }}" target="_blank" rel="noopener"
         class="inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium bg-red-600 text-white hover:bg-red-700 transition-colors">
        ðŸŽ¥ Video
      </a>
      {{ end }}
    </div>
    {{ end }}
  </div>
</article>

<!-- Featured Image (outside of article container) -->
{{ $featured := .Resources.GetMatch "featured.*" }}
{{ if $featured }}
<div class="mb-8 w-full max-w-5xl mx-auto px-4">
  <div class="w-full mb-4">
    <img src="{{ $featured.RelPermalink }}" alt="{{ .Title }}" class="w-full h-auto rounded-lg shadow-lg">
  </div>
  {{ if .Params.featured_caption }}
  <div class="max-w-4xl mx-auto">
    <p class="text-sm md:text-base text-gray-600 dark:text-gray-400 text-center italic leading-relaxed">
      {{ .Params.featured_caption | markdownify }}
    </p>
  </div>
  {{ end }}
</div>
{{ end }}

<div class="w-full max-w-4xl mx-auto px-4">
  <!-- Abstract Section -->
  {{ if .Params.abstract }}
  <section class="mb-8">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 text-center">Abstract</h2>
    <div class="mx-auto">
      <div class="text-gray-700 dark:text-gray-300 leading-relaxed prose prose-lg dark:prose-invert prose-p:text-justify max-w-none mx-auto" style="text-align: justify; text-justify: inter-word;">
        {{ .Params.abstract | markdownify }}
      </div>
    </div>
  </section>
  {{ end }}
  
  <!-- Main Content -->
  {{ if .Content }}
  <section class="mb-8">
    <div class="mx-auto">
      <div class="prose prose-lg dark:prose-invert prose-p:text-justify max-w-none mx-auto" style="text-align: justify; text-justify: inter-word;">
        {{ .Content }}
      </div>
    </div>
  </section>
  {{ end }}
  
  <!-- Summary Section -->
  {{ if .Params.summary }}
  <section class="mb-8">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 text-center">Summary</h2>
    <div class="mx-auto">
      <div class="text-gray-700 dark:text-gray-300 leading-relaxed prose prose-lg dark:prose-invert prose-p:text-justify max-w-none mx-auto" style="text-align: justify; text-justify: inter-word;">
        {{ .Params.summary | markdownify }}
      </div>
    </div>
  </section>
  {{ end }}
  
  <!-- Citation Section -->
  {{ if .Params.show_citation }}
  <section class="mb-8">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 text-center">Citation</h2>
    <div class="mx-auto">
      <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4">
        <pre class="text-sm text-gray-800 dark:text-gray-200 text-left overflow-x-auto" style="white-space: pre-wrap; tab-size: 4;"><code>{{ if .Params.custom_citation }}{{ .Params.custom_citation }}{{ else }}@article{{ "{" }}{{ .Title | replaceRE "[^a-zA-Z0-9]" "" | lower }},
    title={{ "{" }}{{ .Title }}{{ "}" }},
    author={{ "{" }}{{ range $i, $author := .Params.authors }}{{ if $i }}, {{ end }}{{ if eq $author "admin" }}Pengfei Shen{{ else }}{{ $author | replaceRE "\\*$" "" | replaceRE "\\^[0-9]+\\^" "" }}{{ end }}{{ end }}{{ "}" }},
    year={{ "{" }}{{ .Date.Year }}{{ "}" }},{{ if .Params.publication_short }}
    journal={{ "{" }}{{ .Params.publication_short }}{{ "}" }},{{ end }}
{{ "}" }}{{ end }}</code></pre>
      </div>
    </div>
  </section>
  {{ end }}
</div>
</div>
{{ end }}